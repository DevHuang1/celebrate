<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Year Countdown</title>

    <style>
      body {
        margin: 0;
        height: 100vh;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: radial-gradient(circle at top, #020024, #090979, #000);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      canvas {
        position: fixed;
        inset: 0;
        z-index: 0;
      }

      .container {
        text-align: center;
        z-index: 2;
        padding: 1rem;
      }

      h1 {
        font-size: clamp(1.8rem, 6vw, 3.5rem);
      }

      h1.glow {
        color: gold;
        text-shadow: 0 0 10px gold, 0 0 30px orange, 0 0 60px red;
        animation: pulse 1.5s infinite;
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.08);
        }
        100% {
          transform: scale(1);
        }
      }

      #countdown {
        font-size: clamp(2rem, 10vw, 3rem);
        letter-spacing: 0.2em;
      }

      .final {
        font-size: clamp(4rem, 20vw, 8rem);
        font-weight: bold;
        color: gold;
        text-shadow: 0 0 40px red;
        animation: shake 0.4s infinite;
      }

      @keyframes shake {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      .hint {
        font-size: 0.8rem;
        opacity: 0.6;
      }
    </style>
  </head>

  <body>
    <canvas id="canvas"></canvas>

    <div class="container">
      <h1 id="title">ðŸŽ† New Year Countdown ðŸŽ†</h1>
      <div id="countdown">Loading...</div>
      <div class="hint">Tap once to enable sound & voice ðŸ”Š</div>
    </div>

    <!-- AUDIO -->
    <audio
      id="tick"
      src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"
    ></audio>
    <audio
      id="beep"
      src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3"
    ></audio>
    <audio
      id="cheer"
      src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3"
    ></audio>

    <!-- Background Music -->
    <audio
      id="music"
      loop
      src="https://assets.mixkit.co/music/preview/mixkit-happy-new-year-2093.mp3"
    ></audio>

    <script>
      const TEST_MODE = false;

      const TARGET_TIME = TEST_MODE
        ? new Date(Date.now() + 20 * 1000) // 20s test
        : new Date(new Date().getFullYear() + 1, 0, 1, 0, 0, 0);

      /* ---------- ELEMENTS ---------- */
      const canvas = document.getElementById("canvas");
      const ctx = canvas.getContext("2d");
      const countdownEl = document.getElementById("countdown");
      const titleEl = document.getElementById("title");

      const tick = document.getElementById("tick");
      const beep = document.getElementById("beep");
      const cheer = document.getElementById("cheer");
      const music = document.getElementById("music");

      /* ---------- STATE ---------- */
      let soundEnabled = false;
      let spokenSeconds = new Set();
      let fireworksStarted = false;
      let confettiStarted = false;

      /* ---------- ENABLE AUDIO ---------- */
      document.body.addEventListener("pointerdown", () => {
        soundEnabled = true;
      });

      /* ---------- CANVAS ---------- */
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener("resize", resize);

      /* ---------- TIME ---------- */
      function getNextNewYear() {
        return TARGET_TIME;
      }

      /* ---------- VOICE ---------- */
      function speak(text) {
        if (!soundEnabled || !window.speechSynthesis) return;
        const utter = new SpeechSynthesisUtterance(text);
        utter.rate = 1;
        utter.pitch = 1;
        utter.volume = 1;
        speechSynthesis.speak(utter);
      }

      /* ---------- CONFETTI ---------- */
      const confetti = [];
      class Confetto {
        constructor() {
          this.x = Math.random() * canvas.width;
          this.y = Math.random() * -canvas.height;
          this.size = Math.random() * 6 + 4;
          this.color = `hsl(${Math.random() * 360},100%,60%)`;
          this.speed = Math.random() * 3 + 2;
          this.rot = Math.random() * 360;
        }
        update() {
          this.y += this.speed;
          this.rot += this.speed;
          if (this.y > canvas.height) this.y = -10;
        }
        draw() {
          ctx.save();
          ctx.translate(this.x, this.y);
          ctx.rotate((this.rot * Math.PI) / 180);
          ctx.fillStyle = this.color;
          ctx.fillRect(-this.size / 2, -this.size / 2, this.size, this.size);
          ctx.restore();
        }
      }

      function startConfetti() {
        if (confettiStarted) return;
        confettiStarted = true;
        for (let i = 0; i < 150; i++) confetti.push(new Confetto());
      }

      /* ---------- FIREWORKS ---------- */
      const particles = [];
      class Particle {
        constructor(x, y, color) {
          this.x = x;
          this.y = y;
          this.vx = (Math.random() - 0.5) * 6;
          this.vy = (Math.random() - 0.5) * 6;
          this.life = 100;
          this.color = color;
        }
        update() {
          this.x += this.vx;
          this.y += this.vy;
          this.vy += 0.05;
          this.life--;
        }
        draw() {
          ctx.beginPath();
          ctx.arc(this.x, this.y, 2, 0, Math.PI * 2);
          ctx.fillStyle = this.color;
          ctx.fill();
        }
      }

      function createFirework() {
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height * 0.6;
        const color = `hsl(${Math.random() * 360},100%,60%)`;
        for (let i = 0; i < 60; i++) particles.push(new Particle(x, y, color));
      }

      /* ---------- LOOP ---------- */
      function animate() {
        ctx.fillStyle = "rgba(0,0,0,0.25)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        confetti.forEach((c) => {
          c.update();
          c.draw();
        });
        particles.forEach((p, i) => {
          p.update();
          p.draw();
          if (p.life <= 0) particles.splice(i, 1);
        });

        requestAnimationFrame(animate);
      }
      animate();

      /* ---------- COUNTDOWN ---------- */
      function updateCountdown() {
        const diff = getNextNewYear() - new Date();
        const secondsLeft = Math.floor(diff / 1000);

        if (diff <= 0) {
          titleEl.textContent = "ðŸŽ‰ HAPPY NEW YEAR! ðŸŽ‰";
          titleEl.classList.add("glow");
          countdownEl.textContent = "";

          startConfetti();
          if (!fireworksStarted) {
            fireworksStarted = true;
            setInterval(createFirework, 500);
            if (soundEnabled) {
              cheer.play();
              music.volume = 0;
              music.play();
              let fade = setInterval(() => {
                if (music.volume < 0.8) music.volume += 0.05;
                else clearInterval(fade);
              }, 200);
            }
          }
          return;
        }

        if (secondsLeft <= 10) {
          countdownEl.className = "final";
          countdownEl.textContent = secondsLeft;
          startConfetti();

          if (!spokenSeconds.has(secondsLeft)) {
            spokenSeconds.add(secondsLeft);
            speak(secondsLeft.toString());
            if (soundEnabled) beep.play();
          }
        } else {
          const h = Math.floor(diff / 3600000);
          const m = Math.floor(diff / 60000) % 60;
          const s = Math.floor(diff / 1000) % 60;
          countdownEl.className = "";
          countdownEl.textContent =
            String(h).padStart(2, "0") +
            " : " +
            String(m).padStart(2, "0") +
            " : " +
            String(s).padStart(2, "0");
          if (soundEnabled && s === 0) tick.play();
        }
      }

      setInterval(updateCountdown, 1000);
      updateCountdown();
    </script>
  </body>
</html>
